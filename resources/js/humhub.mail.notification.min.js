humhub.module("mail.notification",function(n,e,a){var o,s=e("client"),t=e("ui.loader"),i=e("ui.widget").Widget;n.initOnPjaxLoad=!0;var r=function(){s.get(n.config.url.count).then(function(e){d(parseInt(e.newMessages))})},d=function(e){var n=a("#badge-messages");e&&"0"!=e?(n.empty(),n.append(e),n.fadeIn("fast")):n.css("display","none")};n.export({init:function(e){e||a("#icon-messages").click(function(){o&&o.abort(),a("#loader_messages").parent().find(":not(#loader_messages)").remove(),t.set(a("#loader_messages").show()),s.get(n.config.url.list,{beforeSend:function(e){o=e}}).then(function(e){o=void 0,a("#loader_messages").parent().prepend(a(e.html)),a("#loader_messages").hide()})}),r()},loadMessage:function(e){a("#mail-conversation-root").length?i.instance("#mail-conversation-root").loadMessage(e):s.pjax.redirect(e.url),e.finish()},setMailMessageCount:d,updateCount:r})});