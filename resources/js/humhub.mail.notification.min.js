humhub.module("mail.notification",function(n,e,s){var a,t=e("client"),o=e("ui.loader");n.initOnPjaxLoad=!0;var i=function(){t.get(n.config.url.count).then(function(e){r(parseInt(e.newMessages))})},r=function(e){var n=s("#badge-messages");e&&"0"!=e?(n.empty(),n.append(e),n.fadeIn("fast")):n.css("display","none")};n.export({init:function(e){e||s("#icon-messages").click(function(){a&&a.abort(),s("#loader_messages").parent().find(":not(#loader_messages)").remove(),o.set(s("#loader_messages").show()),t.get(n.config.url.list,{beforeSend:function(e){a=e}}).then(function(e){a=void 0,s("#loader_messages").parent().prepend(s(e.html)),s("#loader_messages").hide()})}),i()},setMailMessageCount:r,updateCount:i})});